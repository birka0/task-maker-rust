<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `task_maker_exec` crate."><meta name="keywords" content="rust, rustlang, rust-lang, task_maker_exec"><title>task_maker_exec - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../dark.css"><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script src="../storage.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="shortcut icon" href="../favicon.ico"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../task_maker_exec/index.html'><div class='logo-container'><img src='../rust-logo.png' alt='logo'></div></a><p class='location'>Crate task_maker_exec</p><div class="sidebar-elems"><a id='all-types' href='all.html'><p>See all task_maker_exec's items</p></a><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></div><p class='location'></p><script>window.sidebarCurrent = {name: 'task_maker_exec', ty: 'mod', relpath: '../'};</script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../src/task_maker_exec/lib.rs.html#1-510' title='goto source code'>[src]</a></span><span class='in-band'>Crate <a class="mod" href=''>task_maker_exec</a></span></h1><div class='docblock'><p>DAG execution dispatching the tasks to the workers.</p>
<p>This crate is able to setup a distributed execution environment by creating an <code>Executor</code> which
spawns some workers, and a client which, talking to the executor, is able to schedule the
execution of a DAG.</p>
<p>A <a href="../task_maker_store/struct.FileStore.html"><code>FileStore</code></a> is used to store the files of the DAG
and <a href="https://doc.rust-lang.org/std/sync/mpsc/fn.channel.html"><code>std::sync::mpsc::channel</code></a> is
used for the internal communication.</p>
<p>A simple <code>Scheduler</code> is used to dispatch the jobs when all their dependencies are ready. When an
execution is not successful (i.e. does not return with zero) all the depending jobs are
cancelled.</p>
<p>All the tasks are run inside a <a href="struct.Sandbox.html"><code>Sandbox</code></a> provided by
<a href="https://crates.io/crates/tabox"><code>tabox</code></a>.</p>
<h2 id="implementation-details" class="section-header"><a href="#implementation-details">Implementation details</a></h2>
<p>In order to support both local and remote evaluation, sharing the same code and logic we need a
layer of abstraction over the execution.</p>
<p>The components of the execution are:</p>
<ul>
<li><a href="struct.ExecutorClient.html"><code>ExecutorClient</code></a> (from now <code>Client</code>) is the component that runs
on the process that wants to execute the DAG, it asks to its executor to run it and gets the
results eventually processing them.</li>
<li><a href="executors/struct.LocalExecutor.html"><code>LocalExecutor</code></a> the component to which the <code>Client</code>
connects to for executing a DAG locally, it internally uses an <code>Executor</code> for actually running
the DAG, but also spawns local workers.</li>
<li><a href="executors/struct.RemoteExecutor.html"><code>RemoteExecutor</code></a> the component to which the <code>Client</code>
connects to for executing a DAG remotely. This usually runs on a remote machine w.r.t the
client's one. It internally uses an <code>Executor</code> for running the DAG but doesn't spawn the
workers since they are remote too. This component is also responsible for listening to the
sockets for the connections of the clients and the workers.</li>
<li><code>Executor</code> the component that abstracts the connection of workers and clients and handles the
actual communication between the scheduler and the clients. This component is also responsible
for spawning the scheduler and keeping it working.</li>
<li><code>Scheduler</code> the component that, given DAGs and notification about the status of the workers
(i.e. worker connection/disconnection/job completion) schedules the execution of the ready
jobs and sends to the clients the notification about their status.</li>
<li><code>WorkerManager</code> the component that handles the connections with the workers and notifies the
scheduler about worker events.</li>
<li><code>Worker</code> the component that actively asks for work to do, waiting a response from the
scheduler, and eventually receive and execute it. After the execution completes, the worker
asks for another job to do.</li>
</ul>
<h3 id="local-execution" class="section-header"><a href="#local-execution">Local execution</a></h3>
<p><img src="https://www.lucidchart.com/publicSegments/view/f0ad0719-2dd4-4c60-9da0-ca0614fd37a1/image.png" alt="Local execution diagram" /></p>
<p>Running locally all the components are spawn in the current process, but different threads.
The communication between them is done using in memory channels, including the one from the
<code>Client</code> to the <code>LocalExecutor</code>.</p>
<p>The <code>Client</code> connects to the <code>LocalExecutor</code>, specifying also the number of workers to spawn.
The local executor spawns an actual executor, a worker manager and that number of workers.</p>
<h3 id="remote-execution" class="section-header"><a href="#remote-execution">Remote execution</a></h3>
<p><img src="https://www.lucidchart.com/publicSegments/view/86167d8f-b231-4698-a8ac-a26ed995fd19/image.png" alt="Local execution diagram" /></p>
<p>In a remote environment the <code>Client</code> connects to the <code>RemoteExecutor</code> via a TCP socket, the
remote executor listens for client and worker connections. The workers then connect to the
<code>RemoteExecutor</code> and they are handled by the <code>WorkerManager</code>.</p>
</div><h2 id='modules' class='section-header'><a href="#modules">Modules</a></h2>
<table><tr class='module-item'><td><a class="mod" href="executors/index.html" title='task_maker_exec::executors mod'>executors</a></td><td class='docblock-short'><p>The supported executors.</p>
</td></tr><tr class='module-item'><td><a class="mod" href="proto/index.html" title='task_maker_exec::proto mod'>proto</a></td><td class='docblock-short'><p>The protocol related structs and enums.</p>
</td></tr></table><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table><tr class='module-item'><td><a class="struct" href="struct.ChannelServer.html" title='task_maker_exec::ChannelServer struct'>ChannelServer</a></td><td class='docblock-short'><p>Listener for connections on some TCP socket.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.ClientInfo.html" title='task_maker_exec::ClientInfo struct'>ClientInfo</a></td><td class='docblock-short'><p>Information about a client of the scheduler.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.ErrorSandboxRunner.html" title='task_maker_exec::ErrorSandboxRunner struct'>ErrorSandboxRunner</a></td><td class='docblock-short'><p>A fake sandbox that don't actually spawn anything and always return an error.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.ExecutorClient.html" title='task_maker_exec::ExecutorClient struct'>ExecutorClient</a></td><td class='docblock-short'><p>This is a client of the <code>Executor</code>, the client is who sends a DAG for an evaluation, provides
some files and receives the callbacks from the server. When the server notifies a callback
function is called by the client.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.ExecutorStatus.html" title='task_maker_exec::ExecutorStatus struct'>ExecutorStatus</a></td><td class='docblock-short'><p>The current status of the <code>Executor</code>, this is sent to the user when the server status is asked.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.ExecutorWorkerStatus.html" title='task_maker_exec::ExecutorWorkerStatus struct'>ExecutorWorkerStatus</a></td><td class='docblock-short'><p>Status of a worker of an <code>Executor</code>.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.SuccessSandboxRunner.html" title='task_maker_exec::SuccessSandboxRunner struct'>SuccessSandboxRunner</a></td><td class='docblock-short'><p>A fake sandbox that don't actually spawn anything and always return successfully with exit code
0.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.UnsafeSandboxRunner.html" title='task_maker_exec::UnsafeSandboxRunner struct'>UnsafeSandboxRunner</a></td><td class='docblock-short'><p>A fake sandbox that simply spawns the process and does not measure anything. No actual
sandboxing is performed, so the process may do bad things.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.Worker.html" title='task_maker_exec::Worker struct'>Worker</a></td><td class='docblock-short'><p>The worker is the component that receives the work from the server and sends the results back.
It computes the results by executing a process inside a sandbox, limiting the available
resources and measuring the used ones.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.WorkerConn.html" title='task_maker_exec::WorkerConn struct'>WorkerConn</a></td><td class='docblock-short'><p>An handle of the connection to the worker.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.WorkerCurrentJobStatus.html" title='task_maker_exec::WorkerCurrentJobStatus struct'>WorkerCurrentJobStatus</a></td><td class='docblock-short'><p>Information about the job the worker is currently doing.</p>
</td></tr></table><h2 id='enums' class='section-header'><a href="#enums">Enums</a></h2>
<table><tr class='module-item'><td><a class="enum" href="enum.ChannelMessage.html" title='task_maker_exec::ChannelMessage enum'>ChannelMessage</a></td><td class='docblock-short'><p>Message type that can be send in a channel.</p>
</td></tr><tr class='module-item'><td><a class="enum" href="enum.ChannelReceiver.html" title='task_maker_exec::ChannelReceiver enum'>ChannelReceiver</a></td><td class='docblock-short'><p>The channel part that receives data.</p>
</td></tr><tr class='module-item'><td><a class="enum" href="enum.ChannelSender.html" title='task_maker_exec::ChannelSender enum'>ChannelSender</a></td><td class='docblock-short'><p>The channel part that sends data.</p>
</td></tr><tr class='module-item'><td><a class="enum" href="enum.RawSandboxResult.html" title='task_maker_exec::RawSandboxResult enum'>RawSandboxResult</a></td><td class='docblock-short'><p>Response of the internal implementation of the sandbox.</p>
</td></tr></table><h2 id='traits' class='section-header'><a href="#traits">Traits</a></h2>
<table><tr class='module-item'><td><a class="trait" href="trait.SandboxRunner.html" title='task_maker_exec::SandboxRunner trait'>SandboxRunner</a></td><td class='docblock-short'><p>Something able to spawn a sandbox, wait for it to exit and return the results.</p>
</td></tr></table><h2 id='functions' class='section-header'><a href="#functions">Functions</a></h2>
<table><tr class='module-item'><td><a class="fn" href="fn.connect_channel.html" title='task_maker_exec::connect_channel fn'>connect_channel</a></td><td class='docblock-short'><p>Connect to a remote channel.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.eval_dag_locally.html" title='task_maker_exec::eval_dag_locally fn'>eval_dag_locally</a></td><td class='docblock-short'><p>Evaluate a DAG locally spawning a new <a href="executors/struct.LocalExecutor.html"><code>LocalExecutor</code></a>
with the specified number of workers.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.new_local_channel.html" title='task_maker_exec::new_local_channel fn'>new_local_channel</a></td><td class='docblock-short'><p>Make a new pair of <code>ChannelSender</code> / <code>ChannelReceiver</code></p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../";window.currentCrate = "task_maker_exec";</script><script src="../aliases.js"></script><script src="../main.js"></script><script defer src="../search-index.js"></script></body></html>